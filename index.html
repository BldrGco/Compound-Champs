<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (keep existing head content unchanged) ... -->
</head>
<body>
    <div class="container">
        <h1>Compound Champs</h1>
        <!-- Add player selection dropdown -->
        <select id="player-select" onchange="updateCurrentPlayer()">
            <option value="Fraser">Fraser</option>
            <option value="Eli">Eli</option>
            <option value="Myla">Myla</option>
        </select>
        <p id="sync-link">Game Link: <a href="#" id="sync-url">Copy this URL to sync</a></p>
        <!-- ... (rest of body remains same until script section) ... -->

    <script>
        // Initialize players from localStorage
        function loadInitialPlayers() {
            return {
                Fraser: JSON.parse(localStorage.getItem('fraser') || '{"earnings":5.00,"tasks":0,"fines":0.00}'),
                Eli: JSON.parse(localStorage.getItem('eli') || '{"earnings":5.00,"tasks":0,"fines":0.00}'),
                Myla: JSON.parse(localStorage.getItem('myla') || '{"earnings":5.00,"tasks":0,"fines":0.00}')
            };
        }
        
        let players = loadInitialPlayers();
        let currentPlayer = localStorage.getItem('currentPlayer') || 'Fraser';

        // Update initialization
        window.onload = function() {
            document.getElementById('player-select').value = currentPlayer;
            const urlParams = new URLSearchParams(window.location.search);
            loadStateFromURL(urlParams);
            renderPlayerControls();
            updateAll();
            updateURL();
        };

        // Modified URL loading
        function loadStateFromURL(params) {
            if (params.has(`${currentPlayer}Earnings`)) {
                players[currentPlayer].earnings = parseFloat(params.get(`${currentPlayer}Earnings`));
            }
            if (params.has(`${currentPlayer}Tasks`)) {
                players[currentPlayer].tasks = parseInt(params.get(`${currentPlayer}Tasks`));
            }
            if (params.has(`${currentPlayer}Fines`)) {
                players[currentPlayer].fines = parseFloat(params.get(`${currentPlayer}Fines`));
            }
            savePlayerData(currentPlayer);
        }

        // New player selection handler
        function updateCurrentPlayer() {
            currentPlayer = document.getElementById('player-select').value;
            localStorage.setItem('currentPlayer', currentPlayer);
            location.reload();
        }

        // Persistence functions
        function savePlayerData(player) {
            localStorage.setItem(player.toLowerCase(), JSON.stringify(players[player]));
        }

        // Updated URL generation
        function updateURL() {
            const params = new URLSearchParams();
            params.set(`${currentPlayer}Earnings`, players[currentPlayer].earnings.toFixed(2));
            params.set(`${currentPlayer}Tasks`, players[currentPlayer].tasks);
            params.set(`${currentPlayer}Fines`, players[currentPlayer].fines.toFixed(2));
            
            const newURL = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
            window.history.replaceState({}, '', newURL);
            document.getElementById('sync-url').href = newURL;
            document.getElementById('sync-url').textContent = newURL;
        }

        // Modified action functions
        function addEarnings(task, amount, button) {
            players[currentPlayer].earnings += amount;
            players[currentPlayer].tasks += 1;
            savePlayerData(currentPlayer);
            showStar(button);
            updateAll();
            updateURL();
        }

        function addFine(player, amount) {
            players[player].earnings -= amount;
            players[player].fines += amount;
            if (players[player].earnings < 0) players[player].earnings = 0;
            savePlayerData(player);
            updateAll();
            updateURL();
        }

        // ... (keep other existing functions unchanged but ensure they use currentPlayer from localStorage) ...
    </script>
</body>
</html>

